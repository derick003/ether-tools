{"version":3,"sources":["webpack:///./src/views/Transfer.vue?5861","webpack:///src/views/Transfer.vue","webpack:///./src/views/Transfer.vue?ce03","webpack:///./src/views/Transfer.vue","webpack:///./src/views/Transfer.vue?71a2"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","connectAddress","attrs","staticStyle","model","value","callback","$$v","contract","expression","number","amount","readFile","slot","on","simulate","directives","name","rawName","modifiers","transfer","totalETHStr","simulationResult","staticRenderFns","ethers","TransferToolAbi","ERC20Abi","provider","signer","toolContract","weth","addressList","fullscreenLoading","totalETH","constants","Zero","mounted","initMetaMask","methods","window","ethereum","enable","then","providers","Web3Provider","getSigner","getAddress","network","getNetwork","chainId","Contract","abi","file","reader","FileReader","onload","async","e","target","result","split","err","console","log","message","showSnackbar","readAsText","raw","checkParams","length","utils","parseUnits","String","totalAmount","mul","tokenApprove","res","i","push","slice","getGasPrice","gasPrice","toString","isWeth","toLowerCase","estimateGas","batchTransfer","gas","eth","formatEther","add","catch","address","token","promise","allowance","lt","approve","MaxUint256","$message","error","component"],"mappings":"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","file":"js/chunk-51581d4d.1d31cac6.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"transfer\"},[_vm._v(\" 钱包: \"+_vm._s(_vm.connectAddress)+\" \"),_c('el-form',{attrs:{\"label-width\":\"100px\"}},[_c('el-form-item',{attrs:{\"label\":\"合约地址\"}},[_c('el-input',{staticStyle:{\"width\":\"280px\"},model:{value:(_vm.contract),callback:function ($$v) {_vm.contract=$$v},expression:\"contract\"}})],1),_c('el-form-item',{attrs:{\"label\":\"单次执行\"}},[_c('el-input',{attrs:{\"placeholder\":\"\"},model:{value:(_vm.number),callback:function ($$v) {_vm.number=$$v},expression:\"number\"}})],1),_c('el-form-item',{attrs:{\"label\":\"发送数量\"}},[_c('el-input',{attrs:{\"placeholder\":\"\"},model:{value:(_vm.amount),callback:function ($$v) {_vm.amount=$$v},expression:\"amount\"}})],1),_c('el-form-item',{attrs:{\"label\":\"地址列表\"}},[_c('el-upload',{staticClass:\"upload-demo\",attrs:{\"drag\":\"\",\"on-change\":_vm.readFile,\"auto-upload\":false,\"action\":\"alert\",\"limit\":1}},[_c('i',{staticClass:\"el-icon-upload\"}),_c('div',{staticClass:\"el-upload__text\"},[_vm._v(\"将文件拖到此处，或\"),_c('em',[_vm._v(\"点击上传\")])]),_c('div',{staticClass:\"el-upload__tip\",attrs:{\"slot\":\"tip\"},slot:\"tip\"},[_vm._v(\"请上传地址列表(excel)\")])])],1),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.simulate}},[_vm._v(\"模拟\")]),_c('el-button',{directives:[{name:\"loading\",rawName:\"v-loading.fullscreen.lock\",value:(_vm.fullscreenLoading),expression:\"fullscreenLoading\",modifiers:{\"fullscreen\":true,\"lock\":true}}],attrs:{\"type\":\"primary\"},on:{\"click\":_vm.transfer}},[_vm._v(\"发送\")])],1),_c('el-form-item',{attrs:{\"label\":\"预花费的ETH\"}},[_c('el-input',{attrs:{\"disabled\":true},model:{value:(_vm.totalETHStr),callback:function ($$v) {_vm.totalETHStr=$$v},expression:\"totalETHStr\"}}),_c('el-input',{attrs:{\"type\":\"textarea\",\"rows\":10},model:{value:(_vm.simulationResult),callback:function ($$v) {_vm.simulationResult=$$v},expression:\"simulationResult\"}})],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n\t<div class=\"transfer\">\r\n\t\t钱包: {{ connectAddress }}\r\n\t\t<el-form label-width=\"100px\">\r\n\t\t\t<el-form-item label=\"合约地址\">\r\n\t\t\t\t<el-input v-model=\"contract\" style=\"width: 280px;\"></el-input>\r\n\t\t\t</el-form-item>\r\n\r\n\t\t\t<el-form-item label=\"单次执行\">\r\n\t\t\t\t<el-input placeholder=\"\" v-model=\"number\"></el-input>\r\n\t\t\t</el-form-item>\r\n\t\t\t\t\r\n\t\t\t<el-form-item label=\"发送数量\">\r\n\t\t\t\t<el-input placeholder=\"\" v-model=\"amount\"></el-input>\r\n\t\t\t</el-form-item>\r\n\r\n\t\t\t<el-form-item label=\"地址列表\">\r\n\t\t\t\t<el-upload class=\"upload-demo\" drag :on-change=\"readFile\" :auto-upload=\"false\" action=\"alert\" :limit=1>\r\n\t\t\t\t\t<i class=\"el-icon-upload\"></i>\r\n\t\t\t\t\t<div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\r\n\t\t\t\t\t<div class=\"el-upload__tip\" slot=\"tip\">请上传地址列表(excel)</div>\r\n\t\t\t\t</el-upload>\r\n\t\t\t</el-form-item>\r\n\r\n\t\t\t<el-form-item>\r\n\t\t\t\t<el-button type=\"primary\" @click=\"simulate\">模拟</el-button>\r\n\t\t\t\t<el-button type=\"primary\" v-loading.fullscreen.lock=\"fullscreenLoading\" @click=\"transfer\">发送</el-button>\r\n\t\t\t</el-form-item>\r\n\r\n\t\t\t<el-form-item label=\"预花费的ETH\">\r\n\t\t\t\t<el-input\r\n\t\t\t\t\tv-model=\"totalETHStr\"\r\n\t\t\t\t\t:disabled=\"true\">\r\n\t\t\t\t</el-input>\r\n\t\t\t\t<el-input\r\n\t\t\t\t\ttype=\"textarea\"\r\n\t\t\t\t\t:rows=\"10\"\r\n\t\t\t\t\tv-model=\"simulationResult\">\r\n\t\t\t\t</el-input>\r\n\t\t\t</el-form-item>\r\n\t\t</el-form>\r\n\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\r\nconst ethers = require('ethers');\r\nconst TransferToolAbi = require('abi/TransferTool.json');\r\nconst ERC20Abi = require('abi/ERC20.json');\r\n\r\nexport default {\r\n\tname: 'Call',\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tconnectAddress: '',\r\n\t\t\tprovider: null,\r\n\t\t\tsigner: null,\r\n\t\t\ttoolContract: null,\r\n\t\t\tweth: '',\r\n\t\t\tcontract: '',\r\n\t\t\tnumber: 100,\r\n\t\t\tamount: '1000000000000000000',\r\n\t\t\taddressList: [],\r\n\t\t\tfullscreenLoading: false,\r\n\t\t\tsimulationResult: '',\r\n\t\t\ttotalETH: ethers.constants.Zero,\r\n\t\t\ttotalETHStr: '0',\r\n\t\t}\r\n\t},\r\n\tmounted: function () {\r\n\t\tthis.initMetaMask();\r\n\t},\r\n\tmethods: {\r\n\t\tasync initMetaMask() {\r\n\t\t\twindow.ethereum.enable().then(this.provider = new ethers.providers.Web3Provider(window.ethereum));\r\n\t\t\tthis.signer = this.provider.getSigner();\r\n\t\t\tthis.connectAddress = await this.signer.getAddress();\r\n\t\t\tconst network = await this.provider.getNetwork();\r\n\t\t\t// console.log(network.chainId)\r\n\t\t\tlet toolContract;\r\n\t\t\tlet weth;\r\n\t\t\tif(network.chainId == 97) {\r\n\t\t\t\ttoolContract = \"0x7B1F48b881EFbE39C3F89116847f1C5bC0f66cb8\";\r\n\t\t\t\tweth = \"0x094616F0BdFB0b526bD735Bf66Eca0Ad254ca81F\";\r\n\t\t\t} else if(network.chainId == 56) {\r\n\t\t\t\ttoolContract = \"0xeda8CBdCfDaC1Db60973a0c687A2F54364F454A9\";\r\n\t\t\t\tweth = \"0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c\";\r\n\t\t\t}\r\n\t\t\tthis.toolContract = new ethers.Contract(toolContract, TransferToolAbi.abi, this.signer);\r\n\t\t\tthis.weth = weth;\r\n\t\t\tthis.contract = weth;\r\n\t\t},\r\n\t\treadFile(file) {\r\n\t\t\tlet reader = new FileReader()\r\n\t\t\treader.onload = async (e) => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthis.addressList = e.target.result.split(\"\\r\\n\");\r\n\t\t\t\t\t// console.log(addressList.length)\r\n\t\t\t\t\t// console.log(addressList);\r\n\t\t\t\t\t// let document = JSON.parse(e.target.result)\r\n\t\t\t\t\t// this.contractJson = document;\r\n\t\t\t\t\t// console.log(\"document\", document);\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.log(`load JSON document from file error: ${err.message}`)\r\n\t\t\t\t\tthis.showSnackbar(`Load JSON document from file error: ${err.message}`, 4000)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treader.readAsText(file.raw)\r\n\t\t},\r\n\t\tasync simulate() {\r\n\t\t\tif(!this.checkParams()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst length = this.addressList.length;\r\n\t\t\tconst amount = ethers.utils.parseUnits(String(this.amount), 0);\r\n\t\t\tconst totalAmount = amount.mul(ethers.utils.parseUnits(String(length), 0));\r\n\r\n\t\t\tthis.tokenApprove(this.contract, totalAmount).then(res => {\r\n\t\t\t\tconst result = [];\r\n\t\t\t\tfor (var i = 0; i < length; i += this.number) {\r\n\t\t\t\t\tresult.push(this.addressList.slice(i, i + this.number));\r\n\t\t\t\t}\r\n\t\t\t\tthis.simulationResult = \"地址数量: \" + length + \" \\r\\n\";\r\n\t\t\t\tthis.simulationResult += \"预计执行: \" + result.length + \"次 \\r\\n\";\r\n\r\n\t\t\t\tthis.provider.getGasPrice().then(gasPrice => {\r\n\t\t\t\t\tthis.simulationResult += \"gasPrice: \"+ gasPrice.toString() + \" \\r\\n\";\r\n\r\n\t\t\t\t\tthis.totalETH = ethers.constants.Zero;\r\n\t\t\t\t\tconst isWeth = this.weth.toLowerCase() == this.contract.toLowerCase();\r\n\r\n\t\t\t\t\tfor(let i = 0; i < result.length; i++) {\r\n\t\t\t\t\t\tthis.toolContract.estimateGas.batchTransfer(\r\n\t\t\t\t\t\t\tthis.contract,\r\n\t\t\t\t\t\t\tresult[i],\r\n\t\t\t\t\t\t\tamount,\r\n\t\t\t\t\t\t\t{value: isWeth ? ethers.utils.parseUnits(String(result[i].length), 0).mul(amount) : 0}\r\n\t\t\t\t\t\t).then((gas) => {\r\n\t\t\t\t\t\t\tconst eth = gas.mul(gasPrice);\r\n\t\t\t\t\t\t\tthis.simulationResult += \"gas: \"+ gas.toString() + \"  ETH: \" + ethers.utils.formatEther(eth.toString()) + \" \\r\\n\";\r\n\t\t\t\t\t\t\tthis.totalETH = this.totalETH.add(eth);\r\n\t\t\t\t\t\t\tthis.totalETHStr = ethers.utils.formatEther(this.totalETH);\r\n\t\t\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t\t\tconsole.log(\"estimateGas.batchTransfer\", err);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t}).catch(err => {console.log(\"gasPrice\", err)});\r\n\t\t\t}).catch(err => {err});\r\n\t\t},\r\n\t\ttransfer() {\r\n\t\t\tif(!this.checkParams()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.fullscreenLoading = true;\r\n\r\n\t\t\tlet contract = new ethers.Contract(this.contract, ERC20Abi.abi, this.signer);\r\n\r\n\t\t\tconst amount = ethers.utils.parseUnits(String(this.amount), 0);\r\n\r\n\t\t\tconst totalAmount = amount.mul(ethers.utils.parseUnits(String(this.addressList.length), 0));\r\n\t\t\tthis.tokenApprove(this.contract, totalAmount).then(res => {\r\n\t\t\t\tconst length = this.addressList.length;\r\n\t\t\t\tconst result = [];\r\n\t\t\t\tfor (var i = 0; i < length; i += this.number) {\r\n\t\t\t\t\tresult.push(this.addressList.slice(i, i + this.number));\r\n\t\t\t\t}\r\n\t\t\t\tconst isWeth = this.weth.toLowerCase() == this.contract.toLowerCase();\r\n\t\t\t\tfor(let i = 0; i < result.length; i++) {\r\n\t\t\t\t\tthis.toolContract.batchTransfer(\r\n\t\t\t\t\t\tcontract.address,\r\n\t\t\t\t\t\tresult[i],\r\n\t\t\t\t\t\tamount,\r\n\t\t\t\t\t\t{value: isWeth ? ethers.utils.parseUnits(String(result[i].length), 0).mul(amount) : 0}\r\n\t\t\t\t\t).then(res => {\r\n\t\t\t\t\t\tconsole.log(\"finished\");\r\n\t\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t\tconsole.log(\"batchTransfer error\", err);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tthis.fullscreenLoading = false;\r\n\t\t\t}).catch(err => err);\r\n\t\t\t\r\n\t\t},\r\n\t\ttokenApprove(token, amount) {\r\n\t\t\tlet contract = new ethers.Contract(token, ERC20Abi.abi, this.signer);\r\n\t\t\tlet promise = contract.allowance(this.connectAddress, this.toolContract.address).then(allowance => {\r\n\t\t\t\tconsole.log(allowance.toString(), amount.toString());\r\n\t\t\t\tconst isWeth = this.weth.toLowerCase() == this.contract.toLowerCase();\r\n\t\t\t\tif(allowance.lt(amount) && !isWeth) {\r\n\t\t\t\t\treturn contract.approve(this.toolContract.address, ethers.constants.MaxUint256).then(res => {return ethers.constants.MaxUint256}).catch(err => {console.log(\"approve\", err)});\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn allowance;\r\n\t\t\t\t}\r\n\t\t\t}).catch(err => {\r\n\t\t\t\tconsole.log(\"allowance err\", err);\r\n\t\t\t});\r\n\t\t\treturn promise;\r\n\t\t},\r\n\t\tcheckParams() {\r\n\t\t\tif (this.contract == '') {\r\n\t\t\t\tthis.$message.error('合约地址不能为空');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (this.number == 0) {\r\n\t\t\t\tthis.$message.error('执行数不能为0');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (this.amount == '') {\r\n\t\t\t\tthis.$message.error('数量不能为空');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (this.addressList.length == 0) {\r\n\t\t\t\tthis.$message.error('地址列表不能为空');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n}\r\n</script>\r\n\r\n<style>\r\nbody,\r\nhtml {\r\n\t-webkit-user-select: text;\r\n}\r\n\r\n.text {\r\n\tfont-size: 14px;\r\n\ttext-align: center;\r\n}\r\n\r\n.clearfix:before,\r\n.clearfix:after {\r\n\tdisplay: table;\r\n\tcontent: \"\";\r\n}\r\n\r\n.clearfix:after {\r\n\tclear: both\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Transfer.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Transfer.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Transfer.vue?vue&type=template&id=a98e02e4&\"\nimport script from \"./Transfer.vue?vue&type=script&lang=js&\"\nexport * from \"./Transfer.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Transfer.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Transfer.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}