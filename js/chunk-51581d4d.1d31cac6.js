(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-51581d4d"],{"69aa":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"transfer"},[t._v(" 钱包: "+t._s(t.connectAddress)+" "),s("el-form",{attrs:{"label-width":"100px"}},[s("el-form-item",{attrs:{label:"合约地址"}},[s("el-input",{staticStyle:{width:"280px"},model:{value:t.contract,callback:function(e){t.contract=e},expression:"contract"}})],1),s("el-form-item",{attrs:{label:"单次执行"}},[s("el-input",{attrs:{placeholder:""},model:{value:t.number,callback:function(e){t.number=e},expression:"number"}})],1),s("el-form-item",{attrs:{label:"发送数量"}},[s("el-input",{attrs:{placeholder:""},model:{value:t.amount,callback:function(e){t.amount=e},expression:"amount"}})],1),s("el-form-item",{attrs:{label:"地址列表"}},[s("el-upload",{staticClass:"upload-demo",attrs:{drag:"","on-change":t.readFile,"auto-upload":!1,action:"alert",limit:1}},[s("i",{staticClass:"el-icon-upload"}),s("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),s("em",[t._v("点击上传")])]),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("请上传地址列表(excel)")])])],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.simulate}},[t._v("模拟")]),s("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:t.transfer}},[t._v("发送")])],1),s("el-form-item",{attrs:{label:"预花费的ETH"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.totalETHStr,callback:function(e){t.totalETHStr=e},expression:"totalETHStr"}}),s("el-input",{attrs:{type:"textarea",rows:10},model:{value:t.simulationResult,callback:function(e){t.simulationResult=e},expression:"simulationResult"}})],1)],1)],1)},r=[];const n=s("c030"),i=s("8aca"),o=s("ad73");var l={name:"Call",data(){return{connectAddress:"",provider:null,signer:null,toolContract:null,weth:"",contract:"",number:100,amount:"1000000000000000000",addressList:[],fullscreenLoading:!1,simulationResult:"",totalETH:n.constants.Zero,totalETHStr:"0"}},mounted:function(){this.initMetaMask()},methods:{async initMetaMask(){window.ethereum.enable().then(this.provider=new n.providers.Web3Provider(window.ethereum)),this.signer=this.provider.getSigner(),this.connectAddress=await this.signer.getAddress();const t=await this.provider.getNetwork();let e,s;97==t.chainId?(e="0x7B1F48b881EFbE39C3F89116847f1C5bC0f66cb8",s="0x094616F0BdFB0b526bD735Bf66Eca0Ad254ca81F"):56==t.chainId&&(e="0xeda8CBdCfDaC1Db60973a0c687A2F54364F454A9",s="0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c"),this.toolContract=new n.Contract(e,i.abi,this.signer),this.weth=s,this.contract=s},readFile(t){let e=new FileReader;e.onload=async t=>{try{this.addressList=t.target.result.split("\r\n")}catch(e){console.log("load JSON document from file error: "+e.message),this.showSnackbar("Load JSON document from file error: "+e.message,4e3)}},e.readAsText(t.raw)},async simulate(){if(!this.checkParams())return;const t=this.addressList.length,e=n.utils.parseUnits(String(this.amount),0),s=e.mul(n.utils.parseUnits(String(t),0));this.tokenApprove(this.contract,s).then(s=>{const a=[];for(var r=0;r<t;r+=this.number)a.push(this.addressList.slice(r,r+this.number));this.simulationResult="地址数量: "+t+" \r\n",this.simulationResult+="预计执行: "+a.length+"次 \r\n",this.provider.getGasPrice().then(t=>{this.simulationResult+="gasPrice: "+t.toString()+" \r\n",this.totalETH=n.constants.Zero;const s=this.weth.toLowerCase()==this.contract.toLowerCase();for(let r=0;r<a.length;r++)this.toolContract.estimateGas.batchTransfer(this.contract,a[r],e,{value:s?n.utils.parseUnits(String(a[r].length),0).mul(e):0}).then(e=>{const s=e.mul(t);this.simulationResult+="gas: "+e.toString()+"  ETH: "+n.utils.formatEther(s.toString())+" \r\n",this.totalETH=this.totalETH.add(s),this.totalETHStr=n.utils.formatEther(this.totalETH)}).catch(t=>{console.log("estimateGas.batchTransfer",t)})}).catch(t=>{console.log("gasPrice",t)})}).catch(t=>{})},transfer(){if(!this.checkParams())return;this.fullscreenLoading=!0;let t=new n.Contract(this.contract,o.abi,this.signer);const e=n.utils.parseUnits(String(this.amount),0),s=e.mul(n.utils.parseUnits(String(this.addressList.length),0));this.tokenApprove(this.contract,s).then(s=>{const a=this.addressList.length,r=[];for(var i=0;i<a;i+=this.number)r.push(this.addressList.slice(i,i+this.number));const o=this.weth.toLowerCase()==this.contract.toLowerCase();for(let l=0;l<r.length;l++)this.toolContract.batchTransfer(t.address,r[l],e,{value:o?n.utils.parseUnits(String(r[l].length),0).mul(e):0}).then(t=>{console.log("finished")}).catch(t=>{console.log("batchTransfer error",t)});this.fullscreenLoading=!1}).catch(t=>t)},tokenApprove(t,e){let s=new n.Contract(t,o.abi,this.signer),a=s.allowance(this.connectAddress,this.toolContract.address).then(t=>{console.log(t.toString(),e.toString());const a=this.weth.toLowerCase()==this.contract.toLowerCase();return t.lt(e)&&!a?s.approve(this.toolContract.address,n.constants.MaxUint256).then(t=>n.constants.MaxUint256).catch(t=>{console.log("approve",t)}):t}).catch(t=>{console.log("allowance err",t)});return a},checkParams(){return""==this.contract?(this.$message.error("合约地址不能为空"),!1):0==this.number?(this.$message.error("执行数不能为0"),!1):""==this.amount?(this.$message.error("数量不能为空"),!1):0!=this.addressList.length||(this.$message.error("地址列表不能为空"),!1)}}},c=l,h=(s("b20e"),s("2877")),u=Object(h["a"])(c,a,r,!1,null,null,null);e["default"]=u.exports},"901f":function(t,e,s){},b20e:function(t,e,s){"use strict";s("901f")}}]);
//# sourceMappingURL=chunk-51581d4d.1d31cac6.js.map