{"version":3,"sources":["webpack:///./src/views/Multi.vue?b2fe","webpack:///src/views/Multi.vue","webpack:///./src/views/Multi.vue?67d7","webpack:///./src/views/Multi.vue","webpack:///./src/views/Multi.vue?0eb4"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","network","attrs","staticStyle","model","value","callback","$$v","contract","expression","readFile","slot","directives","name","rawName","modifiers","on","transfer","staticRenderFns","ethers","ERC20Abi","provider","signer","toolContract","weth","number","amount","addressList","fullscreenLoading","simulationResult","totalETH","constants","Zero","totalETHStr","mounted","initMetaMask","methods","window","ethereum","enable","then","providers","Web3Provider","getNetwork","file","reader","FileReader","onload","async","e","target","result","split","err","console","log","message","showSnackbar","readAsText","raw","checkParams","Contract","abi","utils","parseUnits","String","totalAmount","mul","length","tokenApprove","res","i","push","slice","isWeth","toLowerCase","batchTransfer","address","catch","token","promise","allowance","connectAddress","toString","lt","approve","MaxUint256","$message","error","component"],"mappings":"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","file":"js/chunk-1660b015.fdad8e08.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"multi\"},[_vm._v(\" network: \"+_vm._s(_vm.network)+\" \"),_c('el-form',{attrs:{\"label-width\":\"100px\"}},[_c('el-form-item',{attrs:{\"label\":\"合约地址\"}},[_c('el-input',{staticStyle:{\"width\":\"280px\"},model:{value:(_vm.contract),callback:function ($$v) {_vm.contract=$$v},expression:\"contract\"}})],1),_c('el-form-item',{attrs:{\"label\":\"地址列表\"}},[_c('el-upload',{staticClass:\"upload-demo\",attrs:{\"drag\":\"\",\"on-change\":_vm.readFile,\"auto-upload\":false,\"action\":\"alert\",\"limit\":1}},[_c('i',{staticClass:\"el-icon-upload\"}),_c('div',{staticClass:\"el-upload__text\"},[_vm._v(\"将文件拖到此处，或\"),_c('em',[_vm._v(\"点击上传\")])]),_c('div',{staticClass:\"el-upload__tip\",attrs:{\"slot\":\"tip\"},slot:\"tip\"},[_vm._v(\"请上传私钥列表(excel)\")])])],1),_c('el-form-item',[_c('el-button',{directives:[{name:\"loading\",rawName:\"v-loading.fullscreen.lock\",value:(_vm.fullscreenLoading),expression:\"fullscreenLoading\",modifiers:{\"fullscreen\":true,\"lock\":true}}],attrs:{\"type\":\"primary\"},on:{\"click\":_vm.transfer}},[_vm._v(\"发送\")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n\t<div class=\"multi\">\r\n\t\tnetwork: {{ network }}\r\n\t\t<el-form label-width=\"100px\">\r\n\t\t\t<el-form-item label=\"合约地址\">\r\n\t\t\t\t<el-input v-model=\"contract\" style=\"width: 280px;\"></el-input>\r\n\t\t\t</el-form-item>\r\n\r\n\t\t\t<el-form-item label=\"地址列表\">\r\n\t\t\t\t<el-upload class=\"upload-demo\" drag :on-change=\"readFile\" :auto-upload=\"false\" action=\"alert\" :limit=1>\r\n\t\t\t\t\t<i class=\"el-icon-upload\"></i>\r\n\t\t\t\t\t<div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\r\n\t\t\t\t\t<div class=\"el-upload__tip\" slot=\"tip\">请上传私钥列表(excel)</div>\r\n\t\t\t\t</el-upload>\r\n\t\t\t</el-form-item>\r\n\r\n\t\t\t<el-form-item>\r\n\t\t\t\t<el-button type=\"primary\" v-loading.fullscreen.lock=\"fullscreenLoading\" @click=\"transfer\">发送</el-button>\r\n\t\t\t</el-form-item>\r\n\t\t</el-form>\r\n\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\r\nconst ethers = require('ethers');\r\nconst TransferToolAbi = require('abi/TransferTool.json');\r\nconst ERC20Abi = require('abi/ERC20.json');\r\n\r\nexport default {\r\n\tname: 'Call',\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tnetwork: '',\r\n\t\t\tprovider: null,\r\n\t\t\tsigner: null,\r\n\t\t\ttoolContract: null,\r\n\t\t\tweth: '',\r\n\t\t\tcontract: '',\r\n\t\t\tnumber: 100,\r\n\t\t\tamount: '1000000000000000000',\r\n\t\t\taddressList: [],\r\n\t\t\tfullscreenLoading: false,\r\n\t\t\tsimulationResult: '',\r\n\t\t\ttotalETH: ethers.constants.Zero,\r\n\t\t\ttotalETHStr: '0',\r\n\t\t}\r\n\t},\r\n\tmounted: function () {\r\n\t\tthis.initMetaMask();\r\n\t},\r\n\tmethods: {\r\n\t\tasync initMetaMask() {\r\n\t\t\twindow.ethereum.enable().then(this.provider = new ethers.providers.Web3Provider(window.ethereum));\r\n\t\t\tthis.network = await this.provider.getNetwork();\r\n\t\t},\r\n\t\treadFile(file) {\r\n\t\t\tlet reader = new FileReader()\r\n\t\t\treader.onload = async (e) => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthis.addressList = e.target.result.split(\"\\r\\n\");\r\n\t\t\t\t\t// console.log(addressList.length)\r\n\t\t\t\t\t// console.log(addressList);\r\n\t\t\t\t\t// let document = JSON.parse(e.target.result)\r\n\t\t\t\t\t// this.contractJson = document;\r\n\t\t\t\t\t// console.log(\"document\", document);\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.log(`load JSON document from file error: ${err.message}`)\r\n\t\t\t\t\tthis.showSnackbar(`Load JSON document from file error: ${err.message}`, 4000)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treader.readAsText(file.raw)\r\n\t\t},\r\n\t\ttransfer() {\r\n\t\t\tif(!this.checkParams()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.fullscreenLoading = true;\r\n\r\n\t\t\tlet contract = new ethers.Contract(this.contract, ERC20Abi.abi, this.signer);\r\n\r\n\t\t\tconst amount = ethers.utils.parseUnits(String(this.amount), 0);\r\n\r\n\t\t\tconst totalAmount = amount.mul(ethers.utils.parseUnits(String(this.addressList.length), 0));\r\n\t\t\tthis.tokenApprove(this.contract, totalAmount).then(res => {\r\n\t\t\t\tconst length = this.addressList.length;\r\n\t\t\t\tconst result = [];\r\n\t\t\t\tfor (var i = 0; i < length; i += this.number) {\r\n\t\t\t\t\tresult.push(this.addressList.slice(i, i + this.number));\r\n\t\t\t\t}\r\n\t\t\t\tconst isWeth = this.weth.toLowerCase() == this.contract.toLowerCase();\r\n\t\t\t\tfor(let i = 0; i < result.length; i++) {\r\n\t\t\t\t\tthis.toolContract.batchTransfer(\r\n\t\t\t\t\t\tcontract.address,\r\n\t\t\t\t\t\tresult[i],\r\n\t\t\t\t\t\tamount,\r\n\t\t\t\t\t\t{value: isWeth ? ethers.utils.parseUnits(String(result[i].length), 0).mul(amount) : 0}\r\n\t\t\t\t\t).then(res => {\r\n\t\t\t\t\t\tconsole.log(\"finished\");\r\n\t\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t\tconsole.log(\"batchTransfer error\", err);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tthis.fullscreenLoading = false;\r\n\t\t\t}).catch(err => err);\r\n\t\t\t\r\n\t\t},\r\n\t\ttokenApprove(token, amount) {\r\n\t\t\tlet contract = new ethers.Contract(token, ERC20Abi.abi, this.signer);\r\n\t\t\tlet promise = contract.allowance(this.connectAddress, this.toolContract.address).then(allowance => {\r\n\t\t\t\tconsole.log(allowance.toString(), amount.toString());\r\n\t\t\t\tconst isWeth = this.weth.toLowerCase() == this.contract.toLowerCase();\r\n\t\t\t\tif(allowance.lt(amount) && !isWeth) {\r\n\t\t\t\t\treturn contract.approve(this.toolContract.address, ethers.constants.MaxUint256).then(res => {return ethers.constants.MaxUint256}).catch(err => {console.log(\"approve\", err)});\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn allowance;\r\n\t\t\t\t}\r\n\t\t\t}).catch(err => {\r\n\t\t\t\tconsole.log(\"allowance err\", err);\r\n\t\t\t});\r\n\t\t\treturn promise;\r\n\t\t},\r\n\t\tcheckParams() {\r\n\t\t\tif (this.contract == '') {\r\n\t\t\t\tthis.$message.error('合约地址不能为空');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (this.number == 0) {\r\n\t\t\t\tthis.$message.error('执行数不能为0');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (this.amount == '') {\r\n\t\t\t\tthis.$message.error('数量不能为空');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (this.addressList.length == 0) {\r\n\t\t\t\tthis.$message.error('地址列表不能为空');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n}\r\n</script>\r\n\r\n<style>\r\nbody,\r\nhtml {\r\n\t-webkit-user-select: text;\r\n}\r\n\r\n.text {\r\n\tfont-size: 14px;\r\n\ttext-align: center;\r\n}\r\n\r\n.clearfix:before,\r\n.clearfix:after {\r\n\tdisplay: table;\r\n\tcontent: \"\";\r\n}\r\n\r\n.clearfix:after {\r\n\tclear: both\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Multi.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Multi.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Multi.vue?vue&type=template&id=76ef739d&\"\nimport script from \"./Multi.vue?vue&type=script&lang=js&\"\nexport * from \"./Multi.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Multi.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Multi.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}